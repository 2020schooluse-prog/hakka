<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢èªåœ°åœ–å¤§é—–é—œ - ä¿®æ­£ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ffb7c5;
            --correct: #4caf50;
            --wrong: #f44336;
            --bg-overlay: rgba(255, 255, 255, 0.94);
        }

        body, html {
            height: 100vh; margin: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background: #fff5f7 url('https://images.unsplash.com/photo-1522383225653-ed111181a951?auto=format&fit=crop&q=80&w=2000') no-repeat center center fixed;
            background-size: cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
        }

        /* é—–é—œåœ°åœ– */
        .map-progress-container {
            width: 90%; max-width: 900px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px; padding: 10px; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: space-between;
            position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .map-line {
            position: absolute; top: 50%; left: 5%; right: 5%;
            height: 4px; background: #ccc; z-index: 1; transform: translateY(-50%);
        }

        .city-node {
            width: 45px; height: 45px; background: white; border: 3px solid var(--primary);
            border-radius: 50%; z-index: 2; display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem; color: #d63384; font-weight: bold; transition: 0.3s;
        }

        .city-node.active { background: #d63384; color: white; transform: scale(1.2); }

        /* ä¸»å®¹å™¨ */
        .quiz-container {
            width: 90%; max-width: 1000px;
            background: var(--bg-overlay); backdrop-filter: blur(10px);
            padding: 30px; border-radius: 35px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            border: 4px solid white; text-align: center;
        }

        h1 { color: #d63384; font-size: 2.2rem; margin: 0 0 5px 0; }
        .mode-tag { color: #888; font-size: 1.1rem; margin-bottom: 15px; }

        /* é¡Œç›®æ¡†ï¼šè²¼åˆæ–‡å­— */
        #question-text {
            display: inline-block;
            font-size: 2.5rem; 
            margin-bottom: 25px;
            padding: 10px 25px;
            background: rgba(214, 51, 132, 0.05);
            border-radius: 20px;
            color: #111; line-height: 1.3; font-weight: 700;
            border: 2px dashed var(--primary);
        }

        .options-grid {
            display: grid; grid-template-columns: 1fr; gap: 20px;
        }

        @media (min-width: 800px) {
            .options-grid { grid-template-columns: 1fr 1fr; gap: 25px; }
        }

        /* é¸é …æŒ‰éˆ•ï¼šè²¼åˆæ–‡å­— */
        .option-btn {
            background: white; border: 4px solid var(--primary);
            padding: 15px 20px;
            border-radius: 20px;
            font-size: 1.8rem;
            font-weight: 700; cursor: pointer;
            transition: all 0.2s ease;
            color: #333; box-shadow: 0 6px 0px var(--primary);
            display: flex; justify-content: center; align-items: center;
        }

        .option-btn:hover { transform: translateY(-4px); box-shadow: 0 10px 15px rgba(214,51,132,0.15); }
        .correct { background-color: var(--correct) !important; color: white !important; border-color: #2e7d32 !important; box-shadow: 0 6px 0px #2e7d32 !important; }
        .wrong { background-color: var(--wrong) !important; color: white !important; border-color: #b71c1c !important; box-shadow: 0 6px 0px #b71c1c !important; }
        .disabled { pointer-events: none; }

        #result-screen { display: none; }
        .score-val { font-size: 5rem; color: #d63384; font-weight: bold; }
    </style>
</head>
<body>

<div class="map-progress-container">
    <div class="map-line"></div>
    <div class="city-node active" data-step="0">å±æ±</div>
    <div class="city-node" data-step="3">é«˜é›„</div>
    <div class="city-node" data-step="6">å˜‰ç¾©</div>
    <div class="city-node" data-step="9">å°ä¸­</div>
    <div class="city-node" data-step="12">æ–°ç«¹</div>
    <div class="city-node" data-step="15">å°åŒ—</div>
</div>

<div class="quiz-container" id="main-box">
    <div id="game-screen">
        <h1>ğŸŒ¸ å®¢èªåœ°åœ–å¤§é—–é—œ ğŸŒ¸</h1>
        <div class="mode-tag" id="mode-info">è¼‰å…¥ä¸­...</div>
        <div><div id="question-text">è¼‰å…¥ä¸­...</div></div>
        <div id="options" class="options-grid"></div>
    </div>

    <div id="result-screen">
        <h2>ğŸ‰ é—–é—œæˆåŠŸï¼</h2>
        <div class="score-val" id="score-text">0</div>
        <p id="status-msg" style="font-size:1.4rem;"></p>
        <button onclick="location.reload()" style="font-size:1.8rem; padding:12px 40px; border-radius:50px; background:#d63384; color:white; border:none; cursor:pointer;">ç¹¼çºŒæŒ‘æˆ°</button>
    </div>
</div>

<script>
    // ç›´æ¥å°‡é¡Œåº«åµŒå…¥ï¼Œé¿å…å¤–éƒ¨ JSON è¼‰å…¥å¤±æ•—çš„å•é¡Œ
    const allQuestions = [
        {q: "å£è¹„å’§ï¼ç³–ä»”åˆ†è€å¼Ÿé£Ÿ_____å’§ï¼", a: ["æ·¨æ·¨", "æ·¨ä¿", "æ¸…æ¸…"], ans: 0},
        {q: "è©²å…©å…„å¼Ÿç•¶åƒï¼¿ï¼¿ï¼¿ï¼Œé€æ“ºè¦‹é¢å°±ç›¸åµä»”ã€‚", a: ["ç”Ÿä»½äºº", "è‡ªå®¶äºº", "å†¤ä»‡äºº"], ans: 2},
        {q: "æ³¡ç‰›ä¹³åˆ†å¬°å…’ä»”é£Ÿï¼Œæ„›ç”¨_____ä¾†æ³¡ï¼Œæ­£è¼ƒè¡›ç”Ÿã€‚", a: ["å†·æ°´", "æ»¾æ°´", "æ¶¼æ°´"], ans: 1}
        // ... æ­¤è™•å¯åŠ å…¥æ›´å¤šé¡Œç›®
    ];

    let currentPool = [];
    let currentIdx = 0;
    let score = 0;
    let isLocked = false;

    function initGame() {
        // ç‚ºé¡Œç›®å¢åŠ  ID
        allQuestions.forEach((q, i) => q.id = i);
        
        // å–å¾—éŒ¯é¡Œ
        let wrongIds = JSON.parse(localStorage.getItem('hakka_wrongs')) || [];
        let selected = allQuestions.filter(q => wrongIds.includes(q.id)).sort(() => 0.5 - Math.random()).slice(0, 15);
        
        if (selected.length < 15) {
            let others = allQuestions.filter(q => !wrongIds.includes(q.id)).sort(() => 0.5 - Math.random());
            selected = selected.concat(others.slice(0, 15 - selected.length));
        }
        
        currentPool = selected;
        document.getElementById('mode-info').innerText = wrongIds.length > 0 ? `ğŸ’ª å„ªå…ˆç·´ç¿’ ${Math.min(wrongIds.length, 15)} é¡ŒéŒ¯é¡Œ` : "ğŸ†• å…¨æ–°éš¨æ©ŸæŒ‘æˆ°";
        render();
    }

    function render() {
        if (currentIdx >= currentPool.length) {
            showEnd();
            return;
        }
        isLocked = false;
        const q = currentPool[currentIdx];
        updateMap();
        document.getElementById('question-text').innerText = q.q;
        const optDiv = document.getElementById('options');
        optDiv.innerHTML = "";
        q.a.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = txt;
            btn.onclick = () => check(i, btn);
            optDiv.appendChild(btn);
        });
    }

    function updateMap() {
        document.querySelectorAll('.city-node').forEach(node => {
            if (parseInt(node.dataset.step) <= currentIdx) node.classList.add('active');
        });
    }

    function check(picked, btn) {
        if (isLocked) return;
        isLocked = true;
        const q = currentPool[currentIdx];
        let wrongIds = JSON.parse(localStorage.getItem('hakka_wrongs')) || [];
        
        const btns = document.querySelectorAll('.option-btn');
        btns.forEach(b => b.classList.add('disabled'));

        if (picked === q.ans) {
            score++;
            btn.classList.add('correct');
            wrongIds = wrongIds.filter(id => id !== q.id);
        } else {
            btn.classList.add('wrong');
            btns[q.ans].classList.add('correct');
            if (!wrongIds.includes(q.id)) wrongIds.push(q.id);
        }
        localStorage.setItem('hakka_wrongs', JSON.stringify(wrongIds));
        setTimeout(() => { currentIdx++; render(); }, 1200);
    }

    function showEnd() {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('score-text').innerText = `${score} / ${currentPool.length}`;
    }

    initGame();
</script>
</body>
</html>
