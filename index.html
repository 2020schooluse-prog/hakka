<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¢èªåœ°åœ–å¤§é—–é—œ - ğŸŒ¸ ç²¾ç·»è²¼åˆç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ffb7c5;
            --correct: #4caf50;
            --wrong: #f44336;
            --bg-overlay: rgba(255, 255, 255, 0.94);
        }

        body, html {
            height: 100vh; margin: 0;
            font-family: 'Noto Sans TC', sans-serif;
            background: #fff5f7 url('https://images.unsplash.com/photo-1522383225653-ed111181a951?auto=format&fit=crop&q=80&w=2000') no-repeat center center fixed;
            background-size: cover;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            overflow: hidden;
        }

        /* é—–é—œåœ°åœ– */
        .map-progress-container {
            width: 90%; max-width: 900px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 15px; padding: 10px; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: space-between;
            position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .map-line {
            position: absolute; top: 50%; left: 5%; right: 5%;
            height: 4px; background: #ccc; z-index: 1; transform: translateY(-50%);
        }

        .city-node {
            width: 45px; height: 45px; background: white; border: 3px solid var(--primary);
            border-radius: 50%; z-index: 2; display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem; color: #d63384; font-weight: bold; transition: 0.3s;
        }

        .city-node.active { background: #d63384; color: white; transform: scale(1.2); }

        /* ä¸»å®¹å™¨ */
        .quiz-container {
            width: 90%; max-width: 1000px;
            background: var(--bg-overlay); backdrop-filter: blur(10px);
            padding: 30px; border-radius: 35px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            border: 4px solid white; text-align: center;
        }

        h1 { color: #d63384; font-size: 2.2rem; margin: 0 0 5px 0; }
        .mode-tag { color: #888; font-size: 1.1rem; margin-bottom: 15px; }

        /* é¡Œç›®æ¡†ï¼šè²¼åˆæ–‡å­— */
        #question-text {
            display: inline-block; /* è®“æ¡†å¯¬åº¦éš¨å­—è®Šå‹• */
            font-size: 2.8rem; 
            margin-bottom: 30px;
            padding: 10px 25px; /* ç·Šç¸®å…§è· */
            background: rgba(214, 51, 132, 0.05);
            border-radius: 20px;
            color: #111; line-height: 1.3; font-weight: 700;
            border: 2px dashed var(--primary); /* å¢åŠ ä¸€å€‹è¼•å¾®çš„é¡Œç›®æ¡† */
        }

        .options-grid {
            display: grid; grid-template-columns: 1fr; gap: 20px;
        }

        @media (min-width: 800px) {
            .options-grid { grid-template-columns: 1fr 1fr; gap: 25px; }
        }

        /* é¸é …æŒ‰éˆ•ï¼šè²¼åˆæ–‡å­— */
        .option-btn {
            background: white; border: 4px solid var(--primary);
            padding: 15px 20px; /* å¤§å¹…ç¸®å° Padding ä½¿å…¶è²¼åˆ */
            border-radius: 20px;
            font-size: 2rem; /* å­—é«”ä¾ç„¶å¾ˆå¤§ */
            font-weight: 700; cursor: pointer;
            transition: all 0.2s ease;
            color: #333; box-shadow: 0 6px 0px var(--primary);
            display: flex; justify-content: center; align-items: center;
            min-height: auto; /* å–æ¶ˆæœ€å°é«˜åº¦é™åˆ¶ */
        }

        .option-btn:hover { transform: translateY(-4px); box-shadow: 0 10px 15px rgba(214,51,132,0.15); }

        .correct { background-color: var(--correct) !important; color: white !important; border-color: #2e7d32 !important; box-shadow: 0 6px 0px #2e7d32 !important; }
        .wrong { background-color: var(--wrong) !important; color: white !important; border-color: #b71c1c !important; box-shadow: 0 6px 0px #b71c1c !important; }
        .disabled { pointer-events: none; }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-10px); }
            40%, 80% { transform: translateX(10px); }
        }
        .shake { animation: shake 0.4s ease-in-out; }

        #result-screen { display: none; }
        .score-val { font-size: 7rem; color: #d63384; font-weight: bold; }
    </score-val>
</head>
<body>

<div class="map-progress-container">
    <div class="map-line"></div>
    <div class="city-node active" data-step="0">å±æ±</div>
    <div class="city-node" data-step="3">é«˜é›„</div>
    <div class="city-node" data-step="6">å˜‰ç¾©</div>
    <div class="city-node" data-step="9">å°ä¸­</div>
    <div class="city-node" data-step="12">æ–°ç«¹</div>
    <div class="city-node" data-step="15">å°åŒ—</div>
</div>

<div class="quiz-container" id="main-box">
    <div id="game-screen">
        <h1>ğŸŒ¸ å®¢èªåœ°åœ–å¤§é—–é—œ ğŸŒ¸</h1>
        <div class="mode-tag" id="mode-info">...</div>
        <div><div id="question-text">è¼‰å…¥ä¸­...</div></div>
        <div id="options" class="options-grid"></div>
    </div>

    <div id="result-screen">
        <h2>ğŸ‰ é—–é—œæˆåŠŸï¼</h2>
        <div class="score-val" id="score-text">0</div>
        <p id="review-info" style="font-size:1.6rem;"></p>
        <button onclick="location.reload()" style="font-size:2rem; padding:15px 50px; border-radius:50px; background:#d63384; color:white; border:none; cursor:pointer;">ç¹¼çºŒæŒ‘æˆ°</button>
    </div>
</div>

<script>
    let allQuestions = [];
    let currentPool = [];
    let currentIdx = 0;
    let score = 0;
    let isLocked = false;
    const cities = ["å±æ±", "é«˜é›„", "å˜‰ç¾©", "å°ä¸­", "æ–°ç«¹", "å°åŒ—"];

    async function start() {
        try {
            const resp = await fetch('questions.json');
            allQuestions = await resp.json();
            allQuestions.forEach((q, index) => q.id = index);
            let wrongIds = JSON.parse(localStorage.getItem('hakka_wrong_v2')) || [];
            let selected = [];
            let wrongQuestions = allQuestions.filter(q => wrongIds.includes(q.id));
            selected = wrongQuestions.sort(() => Math.random() - 0.5).slice(0, 15);
            if (selected.length < 15) {
                let remaining = 15 - selected.length;
                let otherQuestions = allQuestions.filter(q => !wrongIds.includes(q.id));
                selected = selected.concat(otherQuestions.sort(() => Math.random() - 0.5).slice(0, remaining));
            }
            currentPool = selected;
            document.getElementById('mode-info').innerText = wrongIds.length > 0 ? `ğŸ’ª æ­£åœ¨è¤‡ç¿’ ${Math.min(wrongIds.length, 15)} é¡ŒéŒ¯é¡Œ` : "ğŸ†• å…¨æ–°éš¨æ©ŸæŒ‘æˆ°";
            render();
        } catch (e) { document.getElementById('question-text').innerText = "âŒ è®€å–å¤±æ•—"; }
    }

    function render() {
        if (currentIdx >= currentPool.length) { showEnd(); return; }
        isLocked = false;
        const q = currentPool[currentIdx];
        document.getElementById('main-box').classList.remove('shake');
        updateMap();
        document.getElementById('question-text').innerText = q.q;
        const optDiv = document.getElementById('options');
        optDiv.innerHTML = "";
        q.a.forEach((txt, i) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = txt;
            btn.onclick = () => check(i, btn);
            optDiv.appendChild(btn);
        });
    }

    function updateMap() {
        const nodes = document.querySelectorAll('.city-node');
        nodes.forEach(node => { if (parseInt(node.dataset.step) <= currentIdx) node.classList.add('active'); });
    }

    function check(picked, btn) {
        if (isLocked) return;
        isLocked = true;
        const q = currentPool[currentIdx];
        const correct = q.ans;
        const allBtns = document.querySelectorAll('.option-btn');
        let wrongIds = JSON.parse(localStorage.getItem('hakka_wrong_v2')) || [];
        allBtns.forEach(b => b.classList.add('disabled'));
        if (picked === correct) {
            score++;
            btn.classList.add('correct');
            wrongIds = wrongIds.filter(id => id !== q.id);
        } else {
            btn.classList.add('wrong');
            allBtns[correct].classList.add('correct');
            document.getElementById('main-box').classList.add('shake');
            if (!wrongIds.includes(q.id)) wrongIds.push(q.id);
        }
        localStorage.setItem('hakka_wrong_v2', JSON.stringify(wrongIds));
        setTimeout(() => { currentIdx++; render(); }, 1200);
    }

    function showEnd() {
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        document.getElementById('score-text').innerText = `${score} / 15`;
    }
    start();
</script>

</body>
</html>
