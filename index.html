<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>æ–°ç«¹æ—…éŠå†’éšªï¼šå®¢èªæ¢éšªå®¶å¤§æŒ‘æˆ°</title>
    <style>
        /* é€™è£¡ä¿ç•™ä½ åŸæœ¬è¯éº—çš„ CSS æ¨£å¼ ... (ç¯‡å¹…åŸå› ç•¥éï¼Œè«‹å»¶ç”¨åŸæœ¬çš„ CSS) */
        :root { --pk-yellow: #FFCB05; --pk-blue: #2A75BB; --pk-red: #EE1515; --pk-green: #4caf50; }
        body { font-family: 'Microsoft JhengHei', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 20px; min-height: 100vh; }
        #game-box { max-width: 600px; margin: auto; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; position: relative; }
        #login-screen, #battle-screen { padding: 40px; text-align: center; }
        .comic-input { width: 80%; padding: 12px; margin: 10px; border: 2px solid #ddd; border-radius: 10px; }
        .start-btn { background: var(--pk-red); color: white; padding: 15px 30px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .opt-btn { width: 100%; padding: 15px; margin: 5px 0; border: none; background: #ffd89b; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .opt-btn:hover { background: #ffcc6f; transform: translateY(-2px); }
        .hp-bar { width: 100%; height: 10px; background: #eee; border-radius: 5px; margin-top: 5px; }
        .hp-fill { height: 100%; background: var(--pk-green); width: 100%; transition: 0.5s; }
        /* å‹•ç•« */
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        .shake { animation: shake 0.2s ease-in-out 3; }
    </style>
</head>
<body>

<div id="game-box">
    <div id="login-screen">
        <h1>æ–°ç«¹æ—…éŠæ¢éšªå®¶ ğŸ«</h1>
        <input type="text" id="stu-class" class="comic-input" placeholder="éŠå®¢éšŠä¼">
        <input type="text" id="stu-name" class="comic-input" placeholder="éŠå®¢åå­—">
        <button class="start-btn" onclick="startGame()">ğŸš€ è¼‰å…¥è³‡æ–™ä¸¦é–‹å§‹ï¼</button>
    </div>

    <div id="battle-screen" style="display:none;">
        <div class="score-display">
            <div>â­ ç©åˆ†: <span id="score-value">0</span></div>
            <div>ğŸ… ç­‰ç´š: <span id="level-value">LV.1</span></div>
            <div class="progress-bar" style="height:5px; background:#ccc; margin:10px 0;">
                <div id="progress-fill" style="height:100%; background:var(--pk-blue); width:0%;"></div>
            </div>
        </div>
        
        <div style="display:flex; justify-content: space-around; padding: 20px;">
            <div id="enemy-area"><div id="enemy-monster" style="font-size:60px;">ğŸ‘¾</div><div class="hp-bar"><div id="enemy-hp" class="hp-fill"></div></div></div>
            <div id="player-area"><div id="my-monster" style="font-size:60px;">ğŸ”¥</div><div class="hp-bar"><div id="my-hp" class="hp-fill"></div></div></div>
        </div>

        <div id="question-box" class="dialogue-box" style="background:#f9f9f9; padding:20px; border-radius:10px; font-weight:bold; margin-bottom:20px;"></div>
        <div id="options"></div>
        <div id="battle-msg" style="height:30px; margin-top:10px; font-weight:bold;"></div>
    </div>
</div>

<script>
    let allQuestions = [];
    let gameQuestions = [];
    let currentIdx = 0;
    let score = 0;
    let playerHP = 100;

    // ä½¿ç”¨ Fetch è®€å– JSON
    async function loadData() {
        try {
            const response = await fetch('questions.json');
            if (!response.ok) throw new Error('æ‰¾ä¸åˆ°é¡Œåº«æª”æ¡ˆ');
            allQuestions = await response.json();
            return true;
        } catch (err) {
            alert('éŒ¯èª¤: ' + err.message + '\nè«‹ç¢ºä¿ questions.json æ”¾åœ¨åŒä¸€å€‹è³‡æ–™å¤¾ï¼Œä¸”ä½¿ç”¨ä¼ºæœå™¨ç’°å¢ƒé–‹å•Ÿã€‚');
            return false;
        }
    }

    async function startGame() {
        const loaded = await loadData();
        if (!loaded) return;

        const name = document.getElementById('stu-name').value;
        const team = document.getElementById('stu-class').value;
        if(!name || !team) return alert("è«‹è¼¸å…¥éšŠä¼èˆ‡åå­—");

        // éš¨æ©ŸæŠ½ 20 é¡Œ
        gameQuestions = allQuestions.sort(() => 0.5 - Math.random()).slice(0, 20);
        
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('battle-screen').style.display = 'block';
        showQuestion();
    }

    function showQuestion() {
        if (currentIdx >= gameQuestions.length) {
            alert("æ¢éšªå®Œæˆï¼ç¸½åˆ†ï¼š" + score);
            location.reload();
            return;
        }

        const qData = gameQuestions[currentIdx];
        document.getElementById('question-box').innerText = `ç¬¬ ${currentIdx+1} é¡Œï¼š${qData.q}`;
        document.getElementById('progress-fill').style.width = `${(currentIdx/20)*100}%`;
        
        const optArea = document.getElementById('options');
        optArea.innerHTML = '';
        
        qData.a.forEach((text, i) => {
            const btn = document.createElement('button');
            btn.className = 'opt-btn';
            btn.innerText = text;
            btn.onclick = () => checkAns(i, qData.ans);
            optArea.appendChild(btn);
        });
    }

    function checkAns(selected, correct) {
        const msg = document.getElementById('battle-msg');
        if (selected === correct) {
            score += 100;
            msg.innerText = "âœ¨ ç­”å°äº†ï¼ç™¼å‹•æ”»æ“Šï¼";
            msg.style.color = "green";
            document.getElementById('enemy-monster').classList.add('shake');
        } else {
            playerHP -= 10;
            msg.innerText = "âŒ ç­”éŒ¯äº†ï¼å—åˆ°åæ“Šï¼";
            msg.style.color = "red";
            document.getElementById('my-monster').classList.add('shake');
        }

        document.getElementById('score-value').innerText = score;
        document.getElementById('my-hp').style.width = playerHP + "%";

        setTimeout(() => {
            document.getElementById('enemy-monster').classList.remove('shake');
            document.getElementById('my-monster').classList.remove('shake');
            msg.innerText = "";
            currentIdx++;
            showQuestion();
        }, 1000);
    }
</script>
</body>
</html>